<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Writing a Development Kit (HDK) - The Holochain Guidebook</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="welcome.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li><ol class="section"><li><a href="overview.html"><strong aria-hidden="true">1.1.</strong> Overview</a></li><li><a href="how_to_contribute.html"><strong aria-hidden="true">1.2.</strong> How to contribute</a></li></ol></li><li><a href="planning_a_dapp.html"><strong aria-hidden="true">2.</strong> Planning a dApp</a></li><li><a href="building_apps.html"><strong aria-hidden="true">3.</strong> Building Holochain Apps: Intro</a></li><li><ol class="section"><li><a href="building_for_different_platforms.html"><strong aria-hidden="true">3.1.</strong> Building for Different Platforms</a></li><li><a href="intro_to_dna_config.html"><strong aria-hidden="true">3.2.</strong> Intro to DNA: Configuration</a></li><li><a href="intro_to_dna_code.html"><strong aria-hidden="true">3.3.</strong> Intro to DNA: Code</a></li><li><a href="intro_to_command_line_tools.html"><strong aria-hidden="true">3.4.</strong> Intro to Command Line Tools</a></li><li><a href="new_project.html"><strong aria-hidden="true">3.5.</strong> Create A New Project</a></li><li><a href="configuring_an_app.html"><strong aria-hidden="true">3.6.</strong> Configuring an App</a></li><li><a href="zome/rust.html"><strong aria-hidden="true">3.7.</strong> Writing in Rust</a></li><li><a href="zome/assemblyscript.html"><strong aria-hidden="true">3.8.</strong> Writing in Assemblyscript</a></li><li><a href="zome/intro_to_webassembly.html"><strong aria-hidden="true">3.9.</strong> Intro to WebAssembly</a></li><li><a href="alpha_migrate.html"><strong aria-hidden="true">3.10.</strong> Updating to Alpha 2</a></li><li><a href="built_with_holochain.html"><strong aria-hidden="true">3.11.</strong> Built With Holochain</a></li></ol></li><li><a href="zome/welcome.html"><strong aria-hidden="true">4.</strong> (E) Building Holochain Apps: Zome Code</a></li><li><ol class="section"><li><a href="zome/adding_a_zome.html"><strong aria-hidden="true">4.1.</strong> (E) Adding a Zome</a></li><li><a href="zome/capabilities.html"><strong aria-hidden="true">4.2.</strong> (E) Capabilities</a></li><li><a href="zome/entry_definitions.html"><strong aria-hidden="true">4.3.</strong> (E) Entry Definitions</a></li><li><a href="zome/read_and_write.html"><strong aria-hidden="true">4.4.</strong> (E) Read &amp; Write Data Operations</a></li><li><a href="zome/entry_validation.html"><strong aria-hidden="true">4.5.</strong> (E) Entry Validation</a></li><li><a href="zome/genesis.html"><strong aria-hidden="true">4.6.</strong> (E) Genesis</a></li><li><a href="zome/linking.html"><strong aria-hidden="true">4.7.</strong> (E) Linking</a></li><li><a href="zome/testing_functions.html"><strong aria-hidden="true">4.8.</strong> (E) Testing Functions</a></li><li><a href="zome/preparing_for_app_packaging.html"><strong aria-hidden="true">4.9.</strong> (E) Preparing For App Packaging</a></li><li><a href="zome/complete_reference.html"><strong aria-hidden="true">4.10.</strong> (E) Complete Zome API Reference</a></li><li><ol class="section"><li><a href="zome/dna_variables.html"><strong aria-hidden="true">4.10.1.</strong> API DNA Variables</a></li><li><a href="zome/api_functions.html"><strong aria-hidden="true">4.10.2.</strong> API Functions</a></li><li><a href="zome/callback_functions.html"><strong aria-hidden="true">4.10.3.</strong> Zome Callbacks</a></li></ol></li><li><a href="zome/node_to_node_messages.html"><strong aria-hidden="true">4.11.</strong> (E) Node to Node Messaging</a></li><li><a href="zome/signatures.html"><strong aria-hidden="true">4.12.</strong> (E) Cryptographic Signatures</a></li><li><a href="zome/calling_other_zomes.html"><strong aria-hidden="true">4.13.</strong> (E) Calling Other Zomes</a></li><li><a href="zome/bundling.html"><strong aria-hidden="true">4.14.</strong> (E) Bundling</a></li><li><a href="zome/emitting_signals.html"><strong aria-hidden="true">4.15.</strong> (E) Emitting Signals</a></li></ol></li><li><a href="apps_user_interfaces.html"><strong aria-hidden="true">5.</strong> (E) Building Holochain Apps: User Interfaces</a></li><li><ol class="section"><li><a href="web_ui_with_websockets.html"><strong aria-hidden="true">5.1.</strong> (E) Web UIs with Websockets</a></li><li><a href="qml_uis.html"><strong aria-hidden="true">5.2.</strong> (E) QML based UIs</a></li></ol></li><li><a href="packaging_and_testing.html"><strong aria-hidden="true">6.</strong> (E) Building Holochain Apps: Packaging And Testing</a></li><li><ol class="section"><li><a href="app_packaging.html"><strong aria-hidden="true">6.1.</strong> (E) Packaging Your App Into DNA</a></li><li><a href="running_an_app.html"><strong aria-hidden="true">6.2.</strong> (E) Running Apps</a></li><li><a href="scenario_testing.html"><strong aria-hidden="true">6.3.</strong> (E) Scenario Testing</a></li></ol></li><li><a href="live_hc_apps.html"><strong aria-hidden="true">7.</strong> (E) Going Live with Holochain Apps</a></li><li><ol class="section"><li><a href="creating_versioned_releases.html"><strong aria-hidden="true">7.1.</strong> (E) Creating Versioned Releases</a></li></ol></li><li><a href="apps_advanced_topics.html"><strong aria-hidden="true">8.</strong> (E) Building Holochain Apps: Advanced Topics</a></li><li><ol class="section"><li><a href="building_for_android.html"><strong aria-hidden="true">8.1.</strong> Building For Android</a></li></ol></li><li><a href="extending_holochain.html"><strong aria-hidden="true">9.</strong> (E) Extending Holochain</a></li><li><ol class="section"><li><a href="embedding_holochain.html"><strong aria-hidden="true">9.1.</strong> (E) Embedding Holochain</a></li><li><ol class="section"><li><a href="core_api.html"><strong aria-hidden="true">9.1.1.</strong> (E) Core API</a></li></ol></li><li><a href="naming_conventions.html"><strong aria-hidden="true">9.2.</strong> Naming conventions</a></li><li><a href="writing_development_kit.html" class="active"><strong aria-hidden="true">9.3.</strong> Writing a Development Kit (HDK)</a></li><li><a href="zome/implementation.html"><strong aria-hidden="true">9.4.</strong> Implementing Zome API functions</a></li><li><a href="state_actions.html"><strong aria-hidden="true">9.5.</strong> Redux Architecture</a></li><li><ol class="section"><li><a href="state/actions.html"><strong aria-hidden="true">9.5.1.</strong> State actions</a></li></ol></li><li><a href="state/actors.html"><strong aria-hidden="true">9.6.</strong> State actors</a></li></ol></li><li><a href="faq.html"><strong aria-hidden="true">10.</strong> FAQ</a></li><li><a href="glossary.html"><strong aria-hidden="true">11.</strong> (E) Glossary</a></li><li><ol class="section"><li><a href="agent.html"><strong aria-hidden="true">11.1.</strong> (E) Agent</a></li><li><a href="keys.html"><strong aria-hidden="true">11.2.</strong> (E) Keys</a></li><li><a href="dna.html"><strong aria-hidden="true">11.3.</strong> (E) DNA</a></li><li><a href="zome.html"><strong aria-hidden="true">11.4.</strong> (E) Zome</a></li><li><a href="source_chain.html"><strong aria-hidden="true">11.5.</strong> (E) Source Chain</a></li><li><a href="distributed_hash_table.html"><strong aria-hidden="true">11.6.</strong> Distributed Hash Table</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                            <button id="edit-button" class="icon-button" type="button" title="Suggest an edit" aria-label="Suggest an edit" aria-haspopup="true" aria-expanded="false">
                                <a href="https://github.com/holochain/holochain-rust/edit/mdbook-push/doc/holochain_101/src/writing_development_kit.md"><i class="fa fa-edit"></i></a>
                            </button>
                        </div>

                        <h1 class="menu-title">The Holochain Guidebook</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#writing-a-development-kit" id="writing-a-development-kit"><h1>Writing a Development Kit</h1></a>
<p>The end goal of a Development Kit is to simplify the experience of writing Zomes that compile to WASM for Holochain apps.</p>
<p>At the time of writing, there is currently one active Developer Kit being written, for the Rust language. While it is possible to look at the <a href="https://github.com/holochain/hdk-rust">Rust language HDK</a> as a reference, this article is a more general guide that outlines what it takes to build a Development Kit.</p>
<p>If you are interested in supporting developers to write Zomes in an unsupported language, you will want to first of all check whether that language can be compiled to WebAssembly, as that is a requirement.</p>
<a class="header" href="#why-development-kits" id="why-development-kits"><h3>Why Development Kits</h3></a>
<p>Development Kits are important because the WASM interface between Zomes and Holochain is really constrained. Because of WASMs design, WASM functions may only be called with 32 bit integers. Holochain implements a solution to this, but if app developers were to always have to interact with this solution directly, it would feel very complex. A Development Kit for each language should ideally be developed so that it gets so much simpler!</p>
<a class="header" href="#the-development-kit-wasm-solution" id="the-development-kit-wasm-solution"><h3>The Development Kit WASM Solution</h3></a>
<p>To enable passing arguments more complex than 32 bit integers between Zomes and Holochain, a pattern of utilizing WASM memory is used. When it is running the WASM code for a Zome, Holochain has access to both read and write from the WASM memory.</p>
<p>The pattern defines that Holochain Zome API functions expect to both give and receive 32 bit integers which actually represent a WASM memory location. So to provide a Holochain Zome API function a complex argument, one must first write it into memory, and then call the function, giving it the memory location. Holochain will pull the argument from memory, execute its behaviour, store the result in memory, and return the memory location of the result. The Zome code then has to <em>also</em> lookup the result by its location in memory.</p>
<p>Technically, an app developer can do all of these things if they have a reason to, but most won't want to handle the extra step involving memory. A Development Kit, then, should handle the extra step of writing to memory, and calling the native API function, and reading the result from memory, and returning that instead. Plus a few other sprinkles on top.</p>
<a class="header" href="#crafting-the-api" id="crafting-the-api"><h3>Crafting the API</h3></a>
<p>Using its WASM interpreter, Holochain exposes its callable Zome API functions by making them available as &quot;imports&quot; in Zome WASM modules. Per the memory discussion above, each of the Zome API functions have the same explicit function signature, but different implicit function signatures. The native functions have each been given a prefix so that Development Kit wrappers can expose a regular function name. Here is a complete list:</p>
<ul>
<li>hc_debug</li>
<li>hc_call</li>
<li>hc_sign</li>
<li>hc_verify_signature</li>
<li>hc_commit_entry</li>
<li>hc_update_entry</li>
<li>hc_update_agent</li>
<li>hc_remove_entry</li>
<li>hc_get_entry</li>
<li>hc_link_entries</li>
<li>hc_query</li>
<li>hc_send</li>
<li>hc_start_bundle</li>
<li>hc_close_bundle</li>
</ul>
<p>There is a special additional one called <code>hc_init_globals</code> which we will discuss further.</p>
<p>The Development Kit should implement and export one function per each native function from the list. The function should be called the same as its native form, but without the prefix. E.g. <code>hc_update_agent</code> should be called <code>update_agent</code> or <code>updateAgent</code>. That function should internally call the native function and handle the additional complexity around that.</p>
<p>In order to call these &quot;external&quot; functions, you will need to import them and provide their signature, but in a WASM import compatible way. In Rust, for example, this is simply:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
extern {
  fn hc_commit_entry(encoded_allocation_of_input: u32) -&gt; u32;
}
#}</code></pre></pre>
<p>TODO: define or link to meaningful function signatures</p>
<a class="header" href="#working-with-wasm-memory" id="working-with-wasm-memory"><h3>Working with WASM Memory</h3></a>
<p>The goal of the Development Kit is to expose a meaningful and easy to use version of the API functions, with meaningful arguments and return values. There is a bit of flexibility around how this is done, as coding languages differ. However, the internal process will be similar in nature. Here it is, generalized:</p>
<ol>
<li>declare, or use a passed, single page 64 KiB memory stack</li>
<li>join whatever inputs are given into a single serializable structure</li>
<li>serialize the given data structure as an array of bytes</li>
<li>determine byte array length</li>
<li>ensure it is not oversized for the stack</li>
<li>allocate the memory</li>
<li>write the byte array to memory</li>
<li>create an allocation pointer for the memory<br />
a. use a 16 bit integer for the pointers <code>offset</code><br />
b. use a 16 bit integer for the pointers <code>length</code></li>
<li>join the pointers into a single 32 bit integer<br />
a. high bits are <code>offset</code><br />
b. low bits are <code>length</code></li>
<li>call the native function with that 32 bit integer and assign the result to another 32 bit integer<br />
a. e.g. <code>encoded_alloc_of_result = hc_commit_entry(encoded_alloc_of_input)</code></li>
<li>deconstruct that 32 bit integer into two variables<br />
a. use a 16 bit integer for the pointers <code>offset</code><br />
b. use a 16 bit integer for the pointers <code>length</code></li>
<li>read string data from memory at the <code>offset</code> address</li>
<li>deallocate the memory</li>
<li>deserialize the string to JSON if JSON is expected</li>
</ol>
<p>That looks like a lot of steps, but most of this code can be shared for the various functions throughout the Development Kit, leaving implementations to be as little as 5 lines long. Basically, the process inverts at the point of the native function call.</p>
<a class="header" href="#wasm-single-page-stack" id="wasm-single-page-stack"><h4>WASM Single Page Stack</h4></a>
<p>TODO</p>
<a class="header" href="#app-globals" id="app-globals"><h3>App Globals</h3></a>
<p>When writing Zome code, it is common to need to reference aspects of the context it runs in, such as the active user/agent, or the DNA hash of the app. Holochain exposes certain values through to the Zome, though it does so natively by way of the <code>hc_init_globals</code> function mentioned. Taking care to expose these values as constants will simplify the developer experience.</p>
<p>This is done by calling <code>hc_init_globals</code> with an input value of 0. The result of calling the function is a 32 bit integer which represents the memory location of a serialized JSON object containing all the app global values. Fetch the result from memory, and deserialize the result back into an object. If appropriate, set those values as exports for the Development Kit. For example, in Rust, values become accessible in Zomes using <code>hdk::APP_NAME</code>. It's recommended to use all capital letters for the export of the constants, but as they are returned as keys on an object from <code>hc_init_globals</code> they are in lower case. The object has the following values:</p>
<ul>
<li>dna_name</li>
<li>dna_hash</li>
<li>agent_id_str</li>
<li>agent_address</li>
<li>agent_initial_hash</li>
<li>agent_latest_hash</li>
</ul>
<p>See the <a href="/zome/api_globals.html">API global variables</a> page for details on what these are.</p>
<a class="header" href="#publish-it-and-get-in-touch" id="publish-it-and-get-in-touch"><h3>Publish It and Get In Touch</h3></a>
<p>If you've made it through the process so far, good work. The community is an important part of the success of any project, and Holochain is no different. If you're really proud of your work, get in touch with the development team on the <a href="https://chat.holochain.net/appsup/channels/hc-core">chat server</a>, mention you're working on it, and request help if necessary. This book could be updated to include links to other HDKs. Whether you would like to, or you'd like the team to, the HDK could be published to the primary package manager in use for the language, to be used by developers around the world. For example, RubyGems for Ruby or npm for nodejs.</p>

                        <hr />
                        <a href="https://github.com/holochain/holochain-rust/edit/mdbook-push/doc/holochain_101/src/writing_development_kit.md">suggest an edit</a>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="naming_conventions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="zome/implementation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="naming_conventions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="zome/implementation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
